# AWS IAM

## IAMユーザー
- AWSアカウント内に作成される特定の個人やアプリケーションを表すエンティティ
- ID・パスワードの組み合わせと、キーペア（アクセスキー・シークレットキー）で認証
- MFA（多要素認証）を有効にすることで、より強固なセキュリティを実現
- ID・パスワードは記憶情報であるが、キーペアは流出のリスクがあるため、追加の認証を設定するように推奨される。
  - 最小権限の法則に従う
  - キーペアはハードコーディングしない
  - キーペアが設定されているユーザーに対して、IPアドレスの制限を付ける
  - 定期的にローテーションを実行する
  - アクセスキーの利用状況を定期的にチェックする

## IAMグループ
- IAMユーザーの集合体
- IAMグループに権限を付与し、IAMユーザーを参加させることで、個々のIAMユーザーの管理の手間を省き、また誤設定のリスクを減らす

## ルートユーザー

### ルートユーザーとは
- AWSアカウントを作成した際に設定したメールアドレスとパスワードでサインインするユーザー
- 全てのAWSサービスとリソースに対して、安全なアクセス権限を持つ
- IAMポリシーによる制限を受けない
- AWS OrgnaizationsのSCPで一部制限が可能

### ルートユーザーの権限

- AWSアカウントの設定変更
- 請求に関する設定
- AWSアカウントの停止


## IAMポリシー

### IAMポリシーとは

- どのプリンシパル（ユーザー、グループ、ロールなど）が、どのAWSリソースに対して、どのようなアクションを、どのような条件下で実行できるか
- JSON形式のドキュメント

### IAMポリシーの種類

- アタッチ先による分類
  - アイデンティティベース：IAMユーザー、グループ、ロールにアタッチして、アクセス許可を設定
  - リソースベース：リソースにアタッチしてアクセス許可を設定

- カスタマイズ方法による分類
  - インラインポリシー：IAMエンティティに埋め込むポリシー
  - 管理ポリシー：AWS管理ポリシーとカスタマー管理ポリシー
    - AWS管理ポリシー：AWSが既定で用意しているポリシー
    - カスタマー管理ポリシー：ユーザーがカスタマイズする

### IAMポリシーのJSONの記述例

```
{
    "Version": "2012-10-17",
    "Statement":[
        {
            "Sid":"EC2FullAccess",
            "Effect":"Allow",
            "Pricipal":"{...}",
            "Action":"ec2.*",
            "Resource":"*",
            "Condition":{
                "StringEquals":{
                    "aws:PrincipalArn":"arn:aws:iam::123456789:user/test-iam-user"
                }
            }
        }
    ]

}
```
- Version: 2012-10-17
- Statement: 複数条件設定
- Sid: 任意の識別子
- Effect: 認可 or 拒否
- Principal: 効果の主体
- Action: 対象アクションのAPI
- Resource: 対象リソース
- Condition: 条件

#### Conditionの例

- StringEquals: 文字列完全一致
- NumericEquals: 数値一致
- Bool: true/false
- ArnEquals: ARNの一致
- DateEquals: 日付一致
